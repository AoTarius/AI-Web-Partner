# 后端集成完成说明

## 已完成的内容

### 1. 数据库设计 ✅
- 使用 SQLite 数据库
- 两张表：`conversations`（对话）和 `messages`（消息）
- 自动创建索引优化查询性能

### 2. 后端 API ✅
- **技术栈**：Node.js + Express + better-sqlite3
- **端口**：http://localhost:3001
- **路径**：`/server` 目录

**文件结构**：
```
/server
  /db             # 数据库文件（自动创建）
  database.js     # 数据库初始化和查询
  index.js        # Express 服务器
  README.md       # API 文档
```

### 3. 前端集成 ✅
- 创建 API 封装：`/src/lib/api.js`
- 更新组件使用真实 API 调用
- 自动获取和显示对话历史
- 实时创建和保存消息

### 4. 开发环境配置 ✅
- Vite 代理配置：前端 `/api` 请求自动转发到后端
- 一键启动：`npm run dev` 同时启动前后端

## 如何使用

### 启动项目
```bash
# 一键启动（推荐）
npm run dev

# 或者分别启动
npm run dev:client  # 前端
npm run dev:server  # 后端
```

### 访问地址
- **前端**：http://localhost:5173
- **后端 API**：http://localhost:3001
- **对话页面**：http://localhost:5173/chat

### 测试流程
1. 访问 http://localhost:5173/chat
2. 会自动创建第一个对话
3. 在输入框输入消息并发送
4. 消息会保存到 SQLite 数据库
5. 刷新页面，历史消息仍然存在
6. 点击"新对话"按钮创建新对话
7. 侧边栏显示所有对话列表
8. 点击对话可切换查看不同对话的消息

## API 接口列表

### 对话管理
- `GET /api/conversations` - 获取所有对话
- `POST /api/conversations` - 创建新对话
- `PATCH /api/conversations/:id` - 更新对话标题
- `DELETE /api/conversations/:id` - 删除对话

### 消息管理
- `GET /api/conversations/:id/messages` - 获取对话消息
- `POST /api/conversations/:id/messages` - 创建消息

详细文档见：`/server/README.md`

## 数据库位置
```
/server/db/chat.db
```

可以使用 SQLite 客户端（如 DB Browser for SQLite）打开查看数据。

## 技术优势

### 为什么选择 Node.js 而不是 Python？
✅ **同一技术栈**：前后端都用 JavaScript，学习成本低
✅ **统一管理**：npm 管理所有依赖，一个项目搞定
✅ **开发简单**：一个命令启动前后端
✅ **性能优秀**：better-sqlite3 是同步 API，速度极快

### 核心特性
- 💾 **持久化存储**：所有对话和消息保存到本地数据库
- 🚀 **快速开发**：轻量级 API，代码简洁
- 🔄 **自动同步**：侧边栏每 5 秒自动刷新对话列表
- 🎨 **完整 UI**：对话列表、消息展示、输入框全部集成

## 下一步可以做什么

1. **集成真实 AI API**（如 OpenAI、Claude）
   - 替换 `ChatPage.jsx` 中的模拟回复
   - 调用实际的 AI 接口

2. **添加更多功能**
   - 对话标题自动生成（从首条消息提取）
   - 搜索对话和消息
   - 导出对话记录
   - 用户认证系统

3. **性能优化**
   - 消息分页加载
   - 虚拟滚动（长对话优化）
   - 请求缓存

4. **部署**
   - 打包生产版本：`npm run build`
   - 部署到云服务器

## 常见问题

**Q: 端口冲突怎么办？**
A: 修改 `server/index.js` 中的 `PORT = 3001` 和 `vite.config.js` 中的代理配置。

**Q: 数据库在哪里？**
A: `/server/db/chat.db`，第一次运行时自动创建。

**Q: 如何重置数据库？**
A: 删除 `/server/db/chat.db` 文件，重新启动服务器会自动创建新数据库。

**Q: 需要单独运行 npm run build 吗？**
A: 开发时不需要，只运行 `npm run dev`。准备上线时才需要 `npm run build`。
